rules:
  - id: nosql-injection-rule
    message: Possible NoSQL injection
    languages:
      - javascript
    severity: HIGH
    metadata:
      technology:
        - mongoose
      cwe: CWE-932
    patterns:
      - pattern-inside: |
          router.$METHOD(..., ($REQ,$RES) => {
            ...
          })
      - pattern-inside: |
          router.$METHOD(..., ($REQ,$RES) => {
            ...
            const {...,$PARAM,...} = req.$ANY
          })
      - pattern-either:
          - pattern: |
              $MODEL.findOne({...,$PARAM,...})
          - pattern: |
              $MODEL.find({...,$PARAM,...})
          - pattern: |
              $MODEL.findById({...,$PARAM,...})
          - pattern: |
              $MODEL.updateOne({...,$PARAM,...})
          - pattern: |
              $MODEL.deleteOne({...,$PARAM,...})
      - metavariable-pattern:
          metavariable: $ANY
          pattern-regex: (body|query|params)
